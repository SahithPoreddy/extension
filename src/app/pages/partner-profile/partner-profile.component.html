<div class="dashboard-layout">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="logo">
        <mat-icon class="logo-icon">handyman</mat-icon>
        <span class="logo-text">UrbanFix Partners</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      @for (item of menuItems; track item.route) {
      <a
        class="nav-item"
        [class.active]="isActive(item.route)"
        (click)="navigate(item.route)"
      >
        <mat-icon class="nav-icon">{{ item.icon }}</mat-icon>
        <span class="nav-label">{{ item.name }}</span>
        @if (item.badge) {
        <span class="nav-badge">{{ item.badge }}</span>
        }
      </a>
      }
    </nav>
  </aside>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <h1 class="page-title">My Profile</h1>
        <p class="page-subtitle">
          Update your personal information and service areas
        </p>
      </div>
      <div class="header-right">
        <button
          mat-icon-button
          [matMenuTriggerFor]="userMenu"
          class="user-menu-btn"
        >
          <mat-icon>account_circle</mat-icon>
        </button>
        <mat-menu #userMenu="matMenu">
          <button mat-menu-item (click)="navigate('profile')">
            <mat-icon>person</mat-icon>
            <span>Profile</span>
          </button>
          <button mat-menu-item (click)="logout()">
            <mat-icon>logout</mat-icon>
            <span>Logout</span>
          </button>
        </mat-menu>
      </div>
    </header>

    <!-- Profile Content -->
    <div class="profile-content">
      <form [formGroup]="profileForm" (ngSubmit)="saveChanges()">
        <!-- Profile Picture Section -->
        <div class="profile-section">
          <h2 class="section-title">Profile Picture</h2>
          <p class="section-subtitle">
            Upload a professional photo to help customers recognize you
          </p>

          <div class="profile-picture-container">
            <div class="profile-picture-wrapper">
              @if (profilePictureUrl) {
              <img
                [src]="profilePictureUrl"
                alt="Profile Picture"
                class="profile-picture"
              />
              } @else {
              <div class="profile-picture-placeholder">
                <mat-icon class="placeholder-icon">person</mat-icon>
                <span class="placeholder-text">{{
                  partnerName.charAt(0) || "JD"
                }}</span>
              </div>
              }
            </div>
            <div class="picture-actions">
              <input
                type="file"
                id="profilePictureInput"
                accept="image/*"
                (change)="onFileSelected($event)"
                style="display: none"
              />
              <button
                type="button"
                mat-raised-button
                (click)="triggerFileInput()"
                class="upload-btn"
              >
                <mat-icon>camera_alt</mat-icon>
                Upload Photo
              </button>
              <p class="upload-hint">
                JPG, PNG or GIF. Max size 2MB. Recommended: 400x400px
              </p>
            </div>
          </div>
        </div>

        <!-- Personal Information Section -->
        <div class="profile-section">
          <h2 class="section-title">Personal Information</h2>
          <p class="section-subtitle">
            Your basic details visible to customers
          </p>

          <div class="form-grid">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Full Name</mat-label>
              <input
                matInput
                formControlName="fullName"
                placeholder="John Doe"
                required
              />
              @if (getErrorMessage('fullName')) {
              <mat-error>{{ getErrorMessage("fullName") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Phone Number</mat-label>
              <input
                matInput
                formControlName="phoneNumber"
                placeholder="+91 98765 43210"
                required
              />
              @if (getErrorMessage('phoneNumber')) {
              <mat-error>{{ getErrorMessage("phoneNumber") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width-span">
              <mat-label>Email Address</mat-label>
              <input
                matInput
                type="email"
                formControlName="email"
                placeholder="john&#64;example.com"
                required
              />
              <mat-hint
                >Email cannot be changed. Contact support if you need to update
                it</mat-hint
              >
              @if (getErrorMessage('email')) {
              <mat-error>{{ getErrorMessage("email") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width-span">
              <mat-label>Bio / About Me</mat-label>
              <textarea
                matInput
                formControlName="bio"
                rows="4"
                placeholder="Tell customers about your experience, skills, and what makes you stand out..."
                [minLength]="50"
                [maxLength]="500"
              ></textarea>
              <mat-hint align="end"
                >{{ profileForm.get("bio")?.value?.length || 0 }} / 500
                characters (min 50)</mat-hint
              >
              @if (getErrorMessage('bio')) {
              <mat-error>{{ getErrorMessage("bio") }}</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <!-- Address Information Section -->
        <div class="profile-section">
          <h2 class="section-title">Address Information</h2>
          <p class="section-subtitle">Your primary business address</p>

          <div class="form-grid">
            <mat-form-field appearance="outline" class="full-width-span">
              <mat-label>Street Address</mat-label>
              <input
                matInput
                formControlName="streetAddress"
                placeholder="Building name, street name"
                required
              />
              @if (getErrorMessage('streetAddress')) {
              <mat-error>{{ getErrorMessage("streetAddress") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>City</mat-label>
              <input
                matInput
                formControlName="city"
                placeholder="City"
                required
              />
              @if (getErrorMessage('city')) {
              <mat-error>{{ getErrorMessage("city") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>State</mat-label>
              <input
                matInput
                formControlName="state"
                placeholder="State"
                required
              />
              @if (getErrorMessage('state')) {
              <mat-error>{{ getErrorMessage("state") }}</mat-error>
              }
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Pincode</mat-label>
              <input
                matInput
                formControlName="pincode"
                placeholder="400001"
                maxlength="6"
                required
              />
              @if (getErrorMessage('pincode')) {
              <mat-error>{{ getErrorMessage("pincode") }}</mat-error>
              }
            </mat-form-field>
          </div>
        </div>

        <!-- Service Areas Section -->
        <div class="profile-section">
          <h2 class="section-title">Service Areas</h2>
          <p class="section-subtitle">
            Add postal codes or area names (e.g., 400001 or Andheri West)
          </p>

          <div class="service-areas-input">
            <mat-form-field appearance="outline" class="area-input">
              <mat-label>Enter postal code or area name</mat-label>
              <input
                matInput
                [(ngModel)]="newPinCode"
                [ngModelOptions]="{ standalone: true }"
                placeholder="e.g., 400001 or Andheri West"
                maxlength="6"
                (keyup.enter)="addServiceArea()"
              />
            </mat-form-field>
            <button
              type="button"
              mat-raised-button
              color="primary"
              (click)="addServiceArea()"
              [disabled]="!isPinCodeValid()"
              class="add-area-btn"
            >
              <mat-icon>add_location</mat-icon>
              Add Area
            </button>
          </div>

          @if (serviceAreas.length === 0) {
          <div class="no-areas-message">
            <mat-icon class="info-icon">location_off</mat-icon>
            <p>No service areas added yet</p>
            <p class="hint-text">
              Add areas where you can provide your services
            </p>
          </div>
          } @else {
          <div class="service-areas-list">
            @for (area of serviceAreas; track area) {
            <div class="area-chip">
              <mat-icon class="area-icon">location_on</mat-icon>
              <span class="area-text">{{ area }}</span>
              <button
                type="button"
                mat-icon-button
                (click)="removeServiceArea(area)"
                class="remove-btn"
              >
                <mat-icon>close</mat-icon>
              </button>
            </div>
            }
          </div>
          }
        </div>

        <!-- Action Buttons -->
        <div class="form-actions">
          <button
            type="button"
            mat-stroked-button
            (click)="cancelChanges()"
            class="cancel-btn"
          >
            Cancel
          </button>
          <button
            type="submit"
            mat-raised-button
            color="primary"
            [disabled]="!isFormValid()"
            class="save-btn"
          >
            <mat-icon>save</mat-icon>
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
